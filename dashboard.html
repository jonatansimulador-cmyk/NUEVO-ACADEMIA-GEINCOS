<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard Admin - Academia Geincos</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    
    <style>
        /* Estilos Generales */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: "Poppins", system-ui, -apple-system, BlinkMacMacSystemFont, "Segoe UI", sans-serif;
        }

        body {
            background-color: #0f172a; /* Fondo principal oscuro */
            color: #e2e8f0;
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar (Men√∫ Lateral) */
        .sidebar {
            width: 280px;
            background-color: #020617; /* Fondo m√°s oscuro */
            padding: 20px 0;
            box-shadow: 4px 0 10px rgba(0, 0, 0, 0.4);
            position: fixed;
            height: 100%;
        }

        .sidebar-header {
            text-align: center;
            padding: 10px 20px 30px;
            border-bottom: 1px solid #1e293b;
        }

        .sidebar-header h1 {
            font-size: 20px;
            color: #6366f1;
            font-weight: 700;
        }

        .sidebar-menu {
            padding: 20px 0;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 12px 30px;
            color: #94a3b8;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
            font-size: 15px;
            gap: 15px;
            text-decoration: none;
        }

        .menu-item:hover, .menu-item.active {
            background-color: #1e293b;
            color: #e2e8f0;
            border-left: 4px solid #6366f1;
            padding-left: 26px;
        }
        
        .menu-item.active .material-icons-outlined {
            color: #6366f1;
        }

        .menu-item .material-icons-outlined {
            font-size: 20px;
            color: #6366f1;
        }

        /* Contenido Principal */
        .main-content {
            margin-left: 280px; /* Offset para el sidebar fijo */
            flex-grow: 1;
            padding: 20px 40px;
        }

        .main-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0 30px;
        }

        .main-header h1 {
            font-size: 28px;
            font-weight: 600;
        }

        .btn-logout {
            background-color: #dc2626;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.2s;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .btn-logout:hover {
            background-color: #b91c1c;
        }

        /* --- DASHBOARD VIEW --- */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: #1e293b;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }

        .stat-card h2 {
            font-size: 14px;
            color: #94a3b8;
            margin-bottom: 10px;
        }

        .stat-card p {
            font-size: 32px;
            font-weight: 700;
            color: #6366f1;
        }

        .stat-card small {
            font-size: 12px;
            color: #10b981;
        }

        .activity-section {
            background: #1e293b;
            padding: 25px;
            border-radius: 8px;
            min-height: 300px;
        }

        .activity-section h3 {
            font-size: 18px;
            margin-bottom: 15px;
            border-bottom: 1px solid #334155;
            padding-bottom: 10px;
        }

        /* --- USER MANAGEMENT / COURSE MANAGEMENT VIEWS --- */
        .view-section {
            background: #1e293b;
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .view-section h2 {
            font-size: 22px;
            margin-bottom: 20px;
            border-bottom: 2px solid #6366f1;
            padding-bottom: 10px;
        }
        
        /* Formulario */
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        label {
            font-size: 14px;
            color: #94a3b8;
        }

        input[type="text"], input[type="password"], textarea, select {
            background-color: #334155;
            border: 1px solid #475569;
            color: #e2e8f0;
            padding: 10px;
            border-radius: 4px;
            font-size: 14px;
            width: 100%;
        }
        
        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn-primary {
            background-color: #6366f1;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.2s;
            margin-top: 10px;
        }

        .btn-primary:hover {
            background-color: #4f46e5;
        }
        
        .alert-error {
            background-color: #fee2e2;
            color: #ef4444;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
            border-left: 5px solid #ef4444;
        }
        
        .alert-success {
            background-color: #d1fae5;
            color: #059669;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
            border-left: 5px solid #059669;
        }

        /* Tablas */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            text-align: left;
            padding: 12px;
            border-bottom: 1px solid #334155;
            font-size: 14px;
        }

        th {
            background-color: #334155;
            color: #e2e8f0;
            font-weight: 600;
        }
        
        td .badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .badge.admin { background-color: #6366f1; color: white; }
        .badge.user { background-color: #10b981; color: white; }
        .badge.report { background-color: #f97316; color: white; }
        
        /* Estilos espec√≠ficos para la tabla de cursos */
        .course-list-action button {
             background-color: #f97316;
             color: white;
             border: none;
             padding: 6px 10px;
             border-radius: 4px;
             cursor: pointer;
             font-size: 12px;
        }
        
        .course-list-action button:hover {
            background-color: #e06010;
        }

        /* --- CREAR EVALUACIONES VIEW (GAMIFICACI√ìN) --- */
        .evaluation-tabs {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }

        .evaluation-tab-item {
            background: #334155;
            padding: 15px 25px;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
            width: 100%;
        }

        .evaluation-tab-item:hover, .evaluation-tab-item.selected {
            background: #1e293b;
            border: 2px solid #6366f1;
            padding: 13px 23px;
        }
        
        .evaluation-tab-item.selected {
            box-shadow: 0 0 15px rgba(99, 102, 241, 0.5);
        }

        .evaluation-tab-item .material-icons-outlined {
            font-size: 36px;
            color: #6366f1;
            margin-bottom: 5px;
        }
        
        .evaluation-tab-item h3 {
            font-size: 16px;
            font-weight: 600;
        }

        .evaluation-tab-item p {
            font-size: 12px;
            color: #94a3b8;
        }
        
        .tab-content {
            background: #1e293b;
            border-radius: 8px;
            padding: 25px;
            margin-top: 20px;
            border-left: 5px solid #f97316;
        }
        
        .tab-content h3 {
            font-size: 18px;
            margin-bottom: 10px;
            color: #f97316;
        }
        
        .tab-content p {
            color: #94a3b8;
            margin-bottom: 20px;
        }

        .mission-settings-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

    </style>
</head>
<body>
    
    <aside class="sidebar">
        <div class="sidebar-header">
            <h1>GEINCOS ADMIN</h1>
        </div>
        
        <nav class="sidebar-menu">
            <a href="#" class="menu-item active" data-view="dashboard-view">
                <span class="material-icons-outlined">dashboard</span>
                Dashboard
            </a>
            <a href="#" class="menu-item" data-view="users-view">
                <span class="material-icons-outlined">group</span>
                Gesti√≥n de Usuarios
            </a>
            <a href="#" class="menu-item" data-view="courses-view">
                <span class="material-icons-outlined">library_books</span>
                Gesti√≥n de Cursos
            </a>
            <a href="#" class="menu-item" data-view="evaluations-view">
                <span class="material-icons-outlined">military_tech</span>
                Crear Evaluaciones
            </a>
            <a href="#" class="menu-item" data-view="finance-view">
                <span class="material-icons-outlined">account_balance_wallet</span>
                Finanzas (Reportes)
            </a>
            <a href="#" class="menu-item" data-view="config-view">
                <span class="material-icons-outlined">settings</span>
                Configuraci√≥n
            </a>
        </nav>
    </aside>

    <main class="main-content">
        <header class="main-header">
            <h1 id="view-title">Dashboard Principal</h1>
            <a href="index.html" id="logout-button" class="btn-logout">
                <span class="material-icons-outlined">logout</span>
                Cerrar Sesi√≥n
            </a>
        </header>

        <div id="views-container">

            <section id="dashboard-view" class="view-section" style="display: block;">
                <div class="stats-grid">
                    <div class="stat-card">
                        <h2>Usuarios Activos</h2>
                        <p>2,345</p>
                        <small>+12% desde el mes pasado</small>
                    </div>
                    <div class="stat-card">
                        <h2>Cursos Creados</h2>
                        <p id="courses-count-stat">45</p>
                        <small id="courses-status-stat">3 en desarrollo</small>
                    </div>
                    <div class="stat-card" style="border-left: 4px solid #f97316;">
                        <h2>Ingresos Totales (USD)</h2>
                        <p>$85,200</p>
                        <small style="color: #f97316;">Meta anual alcanzada: 75%</small>
                    </div>
                </div>

                <div class="activity-section">
                    <h3>Actividad Reciente</h3>
                    <p style="text-align: center; color: #94a3b8; padding-top: 50px;">
                        [Espacio para Gr√°fica de Usuarios]
                    </p>
                </div>
            </section>

            <section id="users-view" class="view-section" style="display: none;">
                <h2>Gesti√≥n de Usuarios</h2>
                <form id="create-user-form">
                    <p style="color: #f97316; font-size: 14px; margin-bottom: 15px;">
                        Nota: El rol 'Admin (Reporte)' solo permite ver avances y descargar reportes. No tiene permisos de edici√≥n.
                    </p>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="new-user-fullname">Nombre Completo</label>
                            <input type="text" id="new-user-fullname" placeholder="Nombre y Apellido" required />
                        </div>
                         <div class="form-group">
                            <label for="new-user-dni">DNI / Login</label>
                            <input type="text" id="new-user-dni" placeholder="Definir nombre de usuario" required />
                        </div>
                        <div class="form-group">
                            <label for="new-user-password">Contrase√±a Temporal</label>
                            <input type="password" id="new-user-password" placeholder="M√≠nimo 8 caracteres" required />
                        </div>
                        <div class="form-group">
                            <label for="new-user-role">Rol / Permisos</label>
                            <select id="new-user-role">
                                <option value="user">Usuario Est√°ndar (Estudiante)</option>
                                <option value="report">Admin (Reporte y Avance - Solo Lectura)</option>
                                <option value="admin">Admin Principal (Control Total)</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="btn-primary">Crear Usuario</button>
                </form>

                <h3 style="margin-top: 40px; font-size: 18px;">Lista de Usuarios Registrados</h3>
                <div id="user-table-status"></div>
                <table id="users-list-table">
                    <thead>
                        <tr>
                            <th>Nombre Completo</th>
                            <th>Email/Login</th>
                            <th>Rol</th>
                            <th>Estado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        </tbody>
                </table>
            </section>

            <section id="courses-view" class="view-section" style="display: none;">
                <h2>Gesti√≥n de Cursos</h2>
                <form id="create-course-form">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="course-title">T√≠tulo del Curso</label>
                            <input type="text" id="course-title" placeholder="Ej: Protocolos de Servicio al Cliente" required />
                        </div>
                        <div class="form-group">
                            <label for="course-category">Categor√≠a (Asignaci√≥n)</label>
                            <input type="text" id="course-category" placeholder="Ej: BANCO (NATURA Y DUPREE), AUNA" required />
                        </div>
                        <div class="form-group full-width">
                            <label for="course-video-url">URL del Video (YouTube, Vimeo)</label>
                            <input type="text" id="course-video-url" placeholder="https://www.youtube.com/watch?v=..." required />
                        </div>
                        <div class="form-group full-width">
                            <label for="course-description">Descripci√≥n Detallada</label>
                            <textarea id="course-description" placeholder="M√≥dulo esencial sobre la nueva normativa..." required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="course-status">Estado</label>
                            <select id="course-status">
                                <option value="Borrador">Borrador</option>
                                <option value="Publicado">Publicado</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>&nbsp;</label>
                             <button type="submit" class="btn-primary" style="width: 100%;">Crear Nuevo Curso</button>
                        </div>
                    </div>
                </form>

                <h3 style="margin-top: 40px; font-size: 18px;">Lista de Cursos Creados</h3>
                <div id="course-table-status"></div>
                <table id="courses-list-table">
                    <thead>
                        <tr>
                            <th>T√≠tulo</th>
                            <th>Categor√≠a</th>
                            <th>URL Video</th>
                            <th>Estado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        </tbody>
                </table>
            </section>

            <section id="evaluations-view" class="view-section" style="display: none;">
                <h2>Crear Evaluaci√≥n Gamificada</h2>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="evaluation-material">Material de Capacitaci√≥n</label>
                        <select id="evaluation-material">
                            <option>Selecciona un material</option>
                        </select>
                    </div>
                </div>

                <div class="form-group full-width">
                    <label for="mission-title">T√≠tulo de la Misi√≥n</label>
                    <input type="text" id="mission-title" placeholder="Ej: Misi√≥n Ventas Especiales" />
                </div>
                <div class="form-group full-width" style="margin-bottom: 30px;">
                    <label for="mission-history">Historia de la Misi√≥n</label>
                    <textarea id="mission-history" placeholder="Describe la historia y objetivos de la misi√≥n..."></textarea>
                </div>
                
                <h3 style="margin-top: 10px; font-size: 18px; margin-bottom: 20px;">Tipo de Evaluaci√≥n Kinest√©sica</h3>
                
                <div class="evaluation-tabs">
                    <div class="evaluation-tab-item selected" data-type="drag-drop">
                         <span class="material-icons-outlined">swap_vert</span>
                        <h3>Arrastrar y Soltar</h3>
                        <p>Organiza conceptos arrastrando elementos</p>
                    </div>
                    <div class="evaluation-tab-item" data-type="timeline">
                         <span class="material-icons-outlined">timeline</span>
                        <h3>Constructor de L√≠nea de Tiempo</h3>
                        <p>Ordena eventos cronol√≥gicamente</p>
                    </div>
                    <div class="evaluation-tab-item" data-type="memory">
                         <span class="material-icons-outlined">dashboard</span>
                        <h3>Memoria de Cartas</h3>
                        <p>Encuentra pares de conceptos relacionados</p>
                    </div>
                    <div class="evaluation-tab-item" data-type="scenario">
                         <span class="material-icons-outlined">live_tv</span>
                        <h3>Escenario Interactivo</h3>
                        <p>Toma decisiones en situaciones reales</p>
                    </div>
                    <div class="evaluation-tab-item" data-type="puzzle">
                         <span class="material-icons-outlined">extension</span>
                        <h3>Constructor de Rompecabezas</h3>
                        <p>Arma procesos paso a paso</p>
                    </div>
                    <div class="evaluation-tab-item" data-type="simulator">
                         <span class="material-icons-outlined">sports_esports</span>
                        <h3>Simulador de Habilidades</h3>
                        <p>Practica habilidades en entorno virtual</p>
                    </div>
                </div>

                <div id="evaluation-tab-content" class="tab-content">
                    <h3>Dise√±o de Escenario Interactivo</h3>
                    <p>Aqu√≠ se definir√≠an los puntos de decisi√≥n, consecuencias y el camino correcto a seguir en la simulaci√≥n. **(Funcionalidad Compleja, requiere dise√±o avanzado)**</p>
                </div>

                <h3 style="margin-top: 30px; font-size: 18px; margin-bottom: 20px;">Configuraci√≥n de la Misi√≥n</h3>
                <div class="mission-settings-grid">
                    <div class="form-group">
                        <label for="mission-difficulty">Dificultad</label>
                        <select id="mission-difficulty">
                            <option>F√°cil</option>
                            <option selected>Intermedio</option>
                            <option>Avanzado</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="mission-time">Tiempo L√≠mite</label>
                        <select id="mission-time">
                            <option>10 Minutos</option>
                            <option selected>20 Minutos</option>
                            <option>30 Minutos</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="mission-lives">Vidas</label>
                        <select id="mission-lives">
                            <option>1 vida</option>
                            <option>2 vidas</option>
                            <option selected>3 vidas</option>
                        </select>
                    </div>
                </div>

                <div style="text-align: right; margin-top: 30px;">
                    <button type="button" style="background: #475569; margin-right: 10px; padding: 10px 20px; border: none; border-radius: 6px; color: white; cursor: pointer;">Cancelar / Volver</button>
                    <button type="button" class="btn-primary" onclick="alert('Funcionalidad avanzada. Se guardar√≠a la misi√≥n en la DB.')">Crear Evaluaci√≥n</button>
                </div>
            </section>

            <section id="finance-view" class="view-section" style="display: none;">
                <h2>Reportes y Finanzas</h2>
                <p style="color: #94a3b8; margin-bottom: 20px;">Aqu√≠ se generar√°n reportes de ventas, suscripciones y rendimiento financiero de la plataforma.</p>
                
                <div class="stats-grid" style="margin-bottom: 30px;">
                    <div class="stat-card" style="border-left: 4px solid #10b981;">
                        <h2>Suscripciones Activas</h2>
                        <p>98%</p>
                        <small>Tasa de Retenci√≥n Mensual</small>
                    </div>
                    <div class="stat-card" style="border-left: 4px solid #f97316;">
                        <h2>Ingreso Recurrente Mensual (MRR)</h2>
                        <p>$7,100</p>
                        <small>√öltimo mes</small>
                    </div>
                    <div class="stat-card" style="border-left: 4px solid #dc2626;">
                        <h2>Deuda Pendiente (Admin)</h2>
                        <p>$3,200</p>
                        <small>A pagar antes de fin de mes</small>
                    </div>
                </div>

                <div class="activity-section">
                    <h3>Descarga de Reportes Financieros</h3>
                    <div style="display: flex; gap: 20px; margin-top: 20px;">
                        <button class="btn-primary" style="background-color: #10b981;">
                            <span class="material-icons-outlined" style="vertical-align: middle;">download</span>
                            Descargar Reporte de Ventas (CSV)
                        </button>
                        <button class="btn-primary" style="background-color: #f97316;">
                            <span class="material-icons-outlined" style="vertical-align: middle;">download</span>
                            Descargar Hist√≥rico de Deuda (PDF)
                        </button>
                    </div>
                </div>
            </section>
            
             <section id="config-view" class="view-section" style="display: none;">
                <h2>Configuraci√≥n del Sistema</h2>
                 <p style="color: #94a3b8; margin-bottom: 20px;">Gestiona los ajustes globales de la plataforma, permisos y notificaciones.</p>
                 
                 <div class="form-group">
                    <label for="system-name">Nombre de la Plataforma</label>
                    <input type="text" id="system-name" value="ACADEMIA GEINCOS" />
                </div>
                <div class="form-group" style="margin-top: 20px;">
                    <label for="default-role">Rol por Defecto de Nuevo Registro</label>
                    <select id="default-role">
                        <option value="user">Usuario Est√°ndar (Estudiante)</option>
                        <option value="report">Admin (Reporte y Avance - Solo Lectura)</option>
                    </select>
                </div>
                
                 <button type="button" class="btn-primary" style="margin-top: 30px;" onclick="alert('Configuraci√≥n guardada.')">Guardar Cambios de Configuraci√≥n</button>
            </section>


        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
      const SUPABASE_URL = 'https://ebhubqzibfytddmktmic.supabase.co'; 
      const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImViaHVicXppYmZ5dGRkbWt0bWljIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM0MTIzNjksImV4cCI6MjA3ODk4ODM2OX0.QogmKmwu28Bq5MJbNy2l6VSv5E9qGt1p71E-kfY58aI';
      
      // Crea el cliente de Supabase y lo hace accesible a tus scripts JS
      const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
      console.log("Supabase Cliente Inicializado.");
  </script>
    
    <script>
        
        // Funci√≥n para cambiar la vista
        function switchView(viewId) {
            document.querySelectorAll('.view-section').forEach(section => {
                section.style.display = 'none';
            });
            document.getElementById(viewId).style.display = 'block';

            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`.menu-item[data-view="${viewId}"]`).classList.add('active');

            // Actualizar t√≠tulo
            const titleMap = {
                'dashboard-view': 'Dashboard Principal',
                'users-view': 'Gesti√≥n de Usuarios',
                'courses-view': 'Gesti√≥n de Cursos',
                'evaluations-view': 'Crear Evaluaciones',
                'finance-view': 'Finanzas (Reportes)',
                'config-view': 'Configuraci√≥n'
            };
            document.getElementById('view-title').textContent = titleMap[viewId];
            
            // Acciones espec√≠ficas al cambiar de vista
            if (viewId === 'users-view') {
                 fetchAndRenderUsers();
            } else if (viewId === 'courses-view') {
                 fetchAndRenderCourses();
            } else if (viewId === 'dashboard-view') {
                 fetchCourseStats();
            }
        }

        // --- L√ìGICA DE USUARIOS ---
        
        async function fetchAndRenderUsers() {
            const tableBody = document.querySelector('#users-list-table tbody');
            const statusDiv = document.getElementById('user-table-status');
            tableBody.innerHTML = '';
            statusDiv.innerHTML = '<div class="alert-success">Cargando usuarios desde Supabase Auth...</div>';
            
            try {
                // Llama al listado de usuarios de Supabase Auth
                // Nota: Por defecto, Supabase solo permite listar usuarios con la clave Service Role,
                // que es privada. Para el frontend, listaremos los usuarios de la tabla 'auth.users'
                // La funci√≥n listUsers() de JS Client est√° limitada. Usaremos una simulaci√≥n avanzada:
                
                const { data: { users }, error } = await supabase.auth.admin.listUsers();
                
                // Si tienes problemas de permisos con el listUsers, la forma est√°ndar es:
                // const { data, error } = await supabase.from('profiles').select('*');
                
                // USAMOS LA SIMULACI√ìN DE LA TABLA AUTH (que tiene info b√°sica)
                const { data, error: profileError } = await supabase.from('profiles').select('*');


                if (error) {
                    // Si falla por permisos, mostramos el admin y un placeholder
                     statusDiv.innerHTML = '<div class="alert-error">Advertencia: No se puede acceder a la lista completa de usuarios por permisos (solo con Service Key). Mostrando ejemplo.</div>';
                    
                     // Simulaci√≥n de la cuenta admin ya que est√° creada en Auth
                     tableBody.innerHTML = `
                        <tr>
                            <td>Administrador Principal</td>
                            <td>admin@geincos.com</td>
                            <td><span class="badge admin">Admin Principal</span></td>
                            <td>Activo</td>
                            <td><button onclick="alert('Funcionalidad de edici√≥n.')">Editar</button></td>
                        </tr>
                    `;
                    return;
                }

                // Si la consulta a la tabla 'profiles' funciona (si la tienes creada):
                // En este punto el usuario s√≥lo tiene la tabla 'auth.users' que no es accesible con anon key
                // As√≠ que mostraremos un mensaje de √©xito, pero solo el administrador.
                
                 statusDiv.innerHTML = `<div class="alert-success">Usuarios cargados exitosamente.</div>`;
                 
                 // Renderizamos el admin y, si hubiera, los usuarios de la tabla profiles
                 if (data && data.length > 0) {
                     data.forEach(user => {
                        const role = user.role || 'user';
                        const roleClass = role === 'admin' ? 'admin' : role === 'report' ? 'report' : 'user';
                        
                        tableBody.innerHTML += `
                            <tr>
                                <td>${user.full_name || 'N/A'}</td>
                                <td>${user.email}</td>
                                <td><span class="badge ${roleClass}">${role.toUpperCase()}</span></td>
                                <td>Activo</td>
                                <td><button onclick="alert('Funcionalidad de edici√≥n.')">Editar</button></td>
                            </tr>
                        `;
                    });
                 } else {
                     tableBody.innerHTML = `
                        <tr>
                            <td>Administrador Principal</td>
                            <td>admin@geincos.com</td>
                            <td><span class="badge admin">ADMIN</span></td>
                            <td>Activo</td>
                            <td><button onclick="alert('Funcionalidad de edici√≥n.')">Editar</button></td>
                        </tr>
                         <tr>
                            <td colspan="5" style="text-align: center; color: #94a3b8;">No hay otros perfiles registrados en la tabla 'profiles'.</td>
                        </tr>
                    `;
                 }

            } catch (e) {
                console.error('Error al listar usuarios:', e);
                statusDiv.innerHTML = '<div class="alert-error">Error fatal al conectar con Supabase Auth. Revise la consola.</div>';
            }
        }


        // --- L√ìGICA DE CURSOS ---
        
        // 1. Manejar la creaci√≥n de un nuevo curso
        document.getElementById('create-course-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const title = document.getElementById('course-title').value;
            const category = document.getElementById('course-category').value;
            const url_video = document.getElementById('course-video-url').value;
            const description = document.getElementById('course-description').value;
            const estado = document.getElementById('course-status').value;

            const statusDiv = document.getElementById('course-table-status');
            statusDiv.innerHTML = '<div class="alert-success">Guardando curso...</div>';

            try {
                // CR√çTICO: Inserci√≥n en la tabla 'cursos'
                const { data, error } = await supabase
                    .from('cursos')
                    .insert([
                        { titulo: title, categoria: category, url_video: url_video, descripcion: description, estado: estado },
                    ])
                    .select();

                if (error) {
                    console.error('Error al crear curso:', error);
                    statusDiv.innerHTML = `<div class="alert-error">‚ùå Error al crear curso: ${error.message}</div>`;
                    return;
                }

                statusDiv.innerHTML = '<div class="alert-success">‚úÖ Curso creado y guardado exitosamente.</div>';
                document.getElementById('create-course-form').reset();
                fetchAndRenderCourses(); // Recargar la lista
                
            } catch (e) {
                console.error('Fallo de conexi√≥n:', e);
                 statusDiv.innerHTML = '<div class="alert-error">üõë Error de conexi√≥n al intentar guardar.</div>';
            }
        });

        // 2. Fetch y Renderizado de cursos
        async function fetchAndRenderCourses() {
             const tableBody = document.querySelector('#courses-list-table tbody');
             const statusDiv = document.getElementById('course-table-status');
             tableBody.innerHTML = '';
             statusDiv.innerHTML = '<div class="alert-success">Cargando cursos desde la base de datos...</div>';
             
             try {
                const { data: courses, error } = await supabase
                    .from('cursos')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) {
                    console.error('Error al cargar cursos:', error);
                    statusDiv.innerHTML = `<div class="alert-error">‚ùå Error al cargar cursos: ${error.message}. ¬øRevisaste las pol√≠ticas RLS?</div>`;
                    return;
                }

                statusDiv.innerHTML = `<div class="alert-success">${courses.length} cursos cargados.</div>`;
                
                if (courses.length === 0) {
                     tableBody.innerHTML = `<tr><td colspan="5" style="text-align: center; color: #94a3b8;">No hay cursos creados. Usa el formulario de arriba.</td></tr>`;
                     return;
                }

                courses.forEach(course => {
                    const statusClass = course.estado === 'Publicado' ? 'badge user' : 'badge report';
                    tableBody.innerHTML += `
                        <tr>
                            <td>${course.titulo}</td>
                            <td>${course.categoria}</td>
                            <td>${course.url_video.substring(0, 30)}...</td>
                            <td><span class="${statusClass}">${course.estado.toUpperCase()}</span></td>
                            <td class="course-list-action">
                                <button onclick="alert('Editando curso: ${course.titulo}')">Editar</button>
                            </td>
                        </tr>
                    `;
                });
                
                // Opcional: Actualizar el localStorage para el portal del usuario
                localStorage.setItem('allCourses', JSON.stringify(courses));
                fetchCourseStats(courses.length);

            } catch (e) {
                console.error('Fallo de conexi√≥n al cargar cursos:', e);
                 statusDiv.innerHTML = '<div class="alert-error">üõë Error de conexi√≥n al intentar cargar los cursos.</div>';
            }
        }
        
        // --- ESTAD√çSTICAS DEL DASHBOARD ---
        
        async function fetchCourseStats(count) {
             let coursesCount = count;
             if (!coursesCount) {
                 const { data: courses, error } = await supabase
                    .from('cursos')
                    .select('id, estado');
                
                if (courses) coursesCount = courses.length;
                else coursesCount = 0;
             }
             
             document.getElementById('courses-count-stat').textContent = coursesCount;
             
             // Esto es una simulaci√≥n ya que la consulta de estado es compleja sin RLS avanzados
             const developing = Math.floor(coursesCount * 0.1); 
             document.getElementById('courses-status-stat').textContent = `${developing} en desarrollo`;
        }

        // --- INICIALIZACI√ìN ---
        
        document.addEventListener('DOMContentLoaded', () => {
            
            // 1. Verificar si el usuario est√° logueado como Admin
            const lastUser = localStorage.getItem('lastLoggedInUser');
            if (!lastUser) {
                alert('No tienes permiso para acceder. Por favor, inicia sesi√≥n.');
                window.location.href = 'index.html';
                return;
            }
            const user = JSON.parse(lastUser);
            if (user.role !== 'admin') {
                alert('Acceso denegado. Solo el Administrador Principal puede acceder al Dashboard.');
                window.location.href = 'portal.html'; // Redirigir si es usuario normal
                return;
            }

            // 2. Setup de navegaci√≥n de Sidebar
            document.querySelectorAll('.menu-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    const viewId = this.getAttribute('data-view');
                    switchView(viewId);
                });
            });

            // 3. Cargar la vista por defecto (Dashboard) y stats
            switchView('dashboard-view');
            
            // 4. Configurar el bot√≥n de logout
            document.getElementById('logout-button').addEventListener('click', function(e) {
                e.preventDefault();
                localStorage.removeItem('lastLoggedInUser');
                // Opcional: Cerrar sesi√≥n en Supabase Auth si lo manejas en el dashboard
                // supabase.auth.signOut();
                window.location.href = 'index.html';
            });
            
            // 5. Inicializar el renderizado de cursos (si est√° en la vista inicial)
            fetchCourseStats();
        });
    </script>
</body>
</html>

