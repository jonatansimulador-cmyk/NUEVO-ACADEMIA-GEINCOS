<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Dashboard - Academia Geincos</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  
  <style>
    /* Estilos Generales y Reset */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: "Poppins", system-ui, -apple-system, BlinkMacMacSystemFont, "Segoe UI", sans-serif;
    }

    /* Fondo principal y estructura del cuerpo */
    body {
      min-height: 100vh;
      background-color: #0f172a;
      color: #e2e8f0;
      display: flex;
    }

    /* BARRA LATERAL (SIDEBAR) */
    .sidebar {
      width: 250px;
      background: #020617;
      padding: 20px;
      box-shadow: 2px 0 10px rgba(0, 0, 0, 0.5);
      position: fixed;
      height: 100vh;
      transition: width 0.3s;
    }

    .sidebar-header {
      text-align: center;
      margin-bottom: 30px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(45, 53, 64, 0.5);
    }
    
    .sidebar-header h2 {
      font-size: 20px;
      font-weight: 600;
      color: #6366f1;
    }

    .sidebar-nav a {
      display: flex;
      align-items: center;
      padding: 12px 15px;
      margin-bottom: 8px;
      text-decoration: none;
      color: #a0aec0;
      border-radius: 8px;
      transition: background-color 0.2s, color 0.2s;
    }

    .sidebar-nav a:hover,
    .sidebar-nav a.active {
      background-color: #1e293b;
      color: #fff;
    }

    .sidebar-nav a .material-icons-outlined {
      margin-right: 15px;
      font-size: 24px;
    }

    /* CONTENIDO PRINCIPAL */
    .main-content {
      flex-grow: 1;
      margin-left: 250px;
      padding: 40px;
      background-color: #0f172a;
    }

    .main-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
    }

    .main-header h1 {
        font-size: 32px;
        font-weight: 700;
    }

    /* Estilos de Tarjetas, Tablas, etc. */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 30px;
      margin-bottom: 40px;
    }

    .stat-card {
      background: #1e293b;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
      border-left: 5px solid;
    }
    
    /* Colores para las m√©tricas */
    .stat-card.registrados { border-left-color: #6366f1; }
    .stat-card.avance { border-left-color: #10b981; }
    .stat-card.notas { border-left-color: #f97316; }
    .stat-card.cursos { border-left-color: #a855f7; }
    /* Colores para Finanzas */
    .stat-card.ingresos { border-left-color: #10b981; }
    .stat-card.pendientes { border-left-color: #dc2626; }


    .stat-card-title {
      font-size: 14px;
      color: #94a3b8;
      margin-bottom: 8px;
    }

    .stat-card-value {
      font-size: 30px;
      font-weight: 700;
      margin-bottom: 5px;
    }
    
    .section-card {
        background: #1e293b;
        border-radius: 12px;
        padding: 30px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        margin-bottom: 30px;
    }
    
    .section-card h2 {
        font-size: 22px;
        font-weight: 600;
        margin-bottom: 20px;
        border-bottom: 1px solid rgba(45, 53, 64, 0.5);
        padding-bottom: 10px;
    }
    
    .btn-action {
        background: #6366f1;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        transition: background-color 0.2s;
        display: flex;
        align-items: center;
        gap: 5px;
    }
    .btn-action:hover {
        background: #4f46e5;
    }

    /* Bot√≥n de volver y guardar en sub-vistas */
    .btn-secondary-action {
        background: #334155;
        color: white;
        padding: 8px 15px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        margin-right: 10px;
    }
    .btn-save-user {
        background: #10b981;
        color: white;
        padding: 8px 15px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
    }
    
    .logout-btn {
        background-color: #dc2626;
        color: white;
        padding: 8px 15px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        transition: background-color 0.2s;
        display: flex;
        align-items: center;
        gap: 5px;
    }
    .logout-btn:hover {
        background-color: #b91c1c;
    }

    /* Estilos de Formulario Comunes */
    .form-group { margin-bottom: 15px; }
    .form-group label { display: block; margin-bottom: 5px; font-weight: 500; color: #e2e8f0; }
    .form-group input[type="text"], .form-group textarea, .form-group select, .form-group input[type="password"] {
        width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #334155;
        background-color: #0f172a; color: #e2e8f0; font-size: 14px; transition: border-color 0.2s;
    }
    .form-group input:focus, .form-group textarea:focus, .form-group select:focus, .form-group input[type="password"]:focus {
        border-color: #6366f1; outline: none;
    }

    /* Contenedor de Permisos de Checkbox */
    .permission-box {
        background: #111827;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 25px;
    }
    .permission-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 15px;
    }
    .permission-item {
        display: flex;
        align-items: center;
        font-size: 14px;
        color: #c4d0e0;
    }
    .permission-item input[type="checkbox"] {
        margin-right: 10px;
        width: 16px;
        height: 16px;
        accent-color: #6366f1; /* Color del checkbox */
    }

    /* Estilos de Tablas (se mantienen) */
    .data-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    .data-table th, .data-table td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #1e293b; }
    .data-table th { background-color: #111827; font-weight: 600; color: #94a3b8; }
    .data-table tr:hover { background-color: #1e293b; }

    /* Estilos de Evaluaci√≥n */
    .section-title-eval {
        font-size: 26px;
        font-weight: 700;
        margin-bottom: 30px;
        display: flex;
        align-items: center;
        gap: 10px;
        color: #e2e8f0;
    }
    .section-title-eval .material-icons {
        font-size: 32px;
        color: #6366f1;
    }

    .evaluation-grid { 
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 20px;
      margin-bottom: 30px;
    }

    .evaluation-card {
        background: #1e293b;
        border-radius: 12px;
        padding: 20px;
        text-align: center;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s, border-color 0.2s;
        border: 2px solid transparent;
        min-height: 150px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }

    .evaluation-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.4);
    }

    .evaluation-card.selected {
        border-color: #6366f1;
        box-shadow: 0 0 0 3px #6366f1, 0 8px 15px rgba(0, 0, 0, 0.4);
    }

    .evaluation-card .material-icons-outlined,
    .evaluation-card .material-icons {
        font-size: 38px;
        color: #6366f1;
        margin-bottom: 10px;
    }

    .evaluation-card h4 {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 5px;
    }

    .evaluation-card p {
        font-size: 12px;
        color: #a0aec0;
    }

    .form-actions {
        display: flex;
        justify-content: flex-end;
        gap: 15px;
        margin-top: 30px;
    }
    .btn-cancel {
        background: #475569;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        transition: background-color 0.2s;
    }
    .btn-cancel:hover { background: #334155; }
    
    .btn-create-eval {
        background: #6366f1;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        transition: background-color 0.2s;
    }
    .btn-create-eval:hover { background: #4f46e5; }


    /* MEDIA QUERY para dispositivos m√≥viles (sidebar colapsable) */
    @media (max-width: 900px) {
        .sidebar { width: 0; overflow: hidden; z-index: 1000; }
        .main-content { margin-left: 0; padding: 20px; }
        .evaluation-grid { grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); }
    }
  </style>
</head>
<body>
  
  <aside class="sidebar">
    <div class="sidebar-header">
      <h2>GEINCOS ADMIN</h2>
    </div>

    <nav class="sidebar-nav">
      <a href="#" class="nav-link active" data-view="dashboard">
        <span class="material-icons-outlined">dashboard</span>
        Dashboard
      </a>
      <a href="#" class="nav-link" data-view="users">
        <span class="material-icons-outlined">people</span>
        Gesti√≥n de Usuarios
      </a>
      <a href="#" class="nav-link" data-view="courses">
        <span class="material-icons-outlined">school</span>
        Gesti√≥n de Cursos
      </a>
      <a href="#" class="nav-link" data-view="evaluations">
        <span class="material-icons-outlined">assessment</span>
        Crear Evaluaciones
      </a>
      <a href="#" class="nav-link" data-view="finance">
        <span class="material-icons-outlined">monetization_on</span>
        Finanzas
      </a>
      <a href="#" class="nav-link" data-view="settings">
        <span class="material-icons-outlined">settings</span>
        Configuraci√≥n
      </a>
    </nav>
  </aside>

  <main class="main-content">
    <header class="main-header">
      <h1 id="view-title">Dashboard Principal</h1>
      <button class="logout-btn" onclick="window.location.href='index.html'">
        <span class="material-icons-outlined">logout</span>
        Cerrar Sesi√≥n
      </button>
    </header>

    <div id="content-container">
        
        <div id="dashboard-view" class="view active">
            <section class="stats-grid" id="dashboard-widgets">
                
                <div class="stat-card registrados">
                    <div class="stat-card-title">Usuarios Registrados</div>
                    <div class="stat-card-value" id="total-registered">...</div>
                    <div style="font-size: 12px; color: #10b981;" id="registered-change">...</div>
                </div>
                
                <div class="stat-card avance">
                    <div class="stat-card-title">Avance Promedio General</div>
                    <div class="stat-card-value" id="average-progress">...</div>
                    <div style="font-size: 12px; color: #e2e8f0;" id="progress-goal">...</div>
                </div>
                
                <div class="stat-card notas">
                    <div class="stat-card-title">Promedio de Notas (Evaluaciones)</div>
                    <div class="stat-card-value" id="average-grade">...</div>
                    <div style="font-size: 12px; color: #f97316;" id="grade-reinforcement">...</div>
                </div>

                <div class="stat-card cursos">
                    <div class="stat-card-title">Cursos Completados (√öltimos 30 d√≠as)</div>
                    <div class="stat-card-value" id="completed-courses">...</div>
                    <div style="font-size: 12px; color: #a855f7;" id="completion-rate">...</div>
                </div>
            </section>
        
            <section class="data-sections">
                <div class="section-card"> <h2>Actividad Reciente</h2> <div style="height: 200px; display: flex; align-items: center; justify-content: center; background: #0f172a; border-radius: 8px; margin-top: 15px;"> <span style="color: #6366f1;">[Espacio para Gr√°fica de Usuarios]</span> </div> </div>
            </section>
        </div>

        <div id="users-view" class="view" style="display: none;">
            
            <div id="list-users-subview">
                <div class="main-actions" style="margin-bottom: 20px; display: flex; justify-content: space-between;">
                    <button class="btn-action" onclick="showSubView('create-user-subview')">
                        <span class="material-icons-outlined">add</span>
                        A√±adir Nuevo Usuario
                    </button>
                </div>

                <div class="section-card">
                    <h2>Lista de Usuarios Registrados (<span id="user-count-display">...</span>)</h2>
                    <table class="data-table"> <thead> <tr> <th>ID</th> <th>Nombre Completo</th> <th>Usuario</th> <th>DNI</th> <th>Estado</th> <th>Rol</th> <th>Acciones</th> </tr> </thead> 
                        <tbody id="user-table-body">
                            </tbody>
                    </table>
                </div>
            </div>

            <div id="create-user-subview" style="display: none;">
                <div class="section-card">
                    <h2>Crear Cuenta de Personal Administrativo</h2>
                    <p style="color: #f97316; margin-bottom: 20px;">Nota: Solo el Administrador Principal puede crear cuentas con permisos administrativos.</p>
                    <form id="create-admin-form">
                        
                        <div class="form-group">
                            <label for="admin-name">Nombre Completo</label>
                            <input type="text" id="admin-name" placeholder="Nombre y Apellido" required>
                        </div>
                        <div class="form-group">
                            <label for="admin-username">Usuario (Login)</label>
                            <input type="text" id="admin-username" placeholder="Definir nombre de usuario" required>
                        </div>
                        <div class="form-group">
                            <label for="admin-password">Contrase√±a Temporal</label>
                            <input type="password" id="admin-password" placeholder="M√≠nimo 8 caracteres" required minlength="8">
                        </div>
                        
                        <h3 style="margin-top: 30px; font-weight: 600; font-size: 16px; margin-bottom: 10px;">Permisos Granulares (Admin)</h3>
                        <div class="permission-box">
                            <div class="permission-grid">
                                
                                <div class="permission-item">
                                    <input type="checkbox" id="perm-view-dash" name="perm-view-dash" checked disabled>
                                    <label for="perm-view-dash">Ver Dashboard (Avance/Reportes)</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm-download-report" name="perm-download-report">
                                    <label for="perm-download-report">Descargar Reportes (Excel)</label>
                                </div>

                                <div class="permission-item">
                                    <input type="checkbox" id="perm-create-users" name="perm-create-users">
                                    <label for="perm-create-users">Crear Cuentas de Usuarios</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm-manage-courses" name="perm-manage-courses">
                                    <label for="perm-manage-courses">Crear/Editar Material (Cursos)</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm-manage-evals" name="perm-manage-evals">
                                    <label for="perm-manage-evals">Crear/Editar Evaluaciones</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm-manage-admins" name="perm-manage-admins" disabled>
                                    <label for="perm-manage-admins">Gestionar Admins (M√°ximo)</label>
                                </div>
                                
                            </div>
                            <small style="color: #94a3b8; display: block; margin-top: 15px;">*Los permisos 'Ver Dashboard' y 'Gestionar Admins' est√°n predefinidos por rol.</small>
                        </div>

                        <div style="margin-top: 30px; text-align: right;">
                            <button type="button" class="btn-secondary-action" onclick="showSubView('list-users-subview')">Cancelar / Volver</button>
                            <button type="submit" class="btn-save-user">
                                <span class="material-icons-outlined" style="font-size: 18px; margin-right: 5px;">person_add</span>
                                Crear Usuario
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <div id="courses-view" class="view" style="display: none;">
            <div class="section-card"> <h2>üìö Crear Nuevo Curso y Material</h2> <form id="create-course-form"> <div class="form-group"> <label for="course-title">T√≠tulo del Curso</label> <input type="text" id="course-title" placeholder="Ej: Fundamentos de Liderazgo" required> </div> <div class="form-group"> <label for="course-description">Descripci√≥n Breve</label> <textarea id="course-description" rows="3" placeholder="Resumen del contenido y objetivos" required></textarea> </div> <div class="form-group"> <label for="video-url">URL de Video (YouTube, Vimeo, etc.)</label> <input type="text" id="video-url" placeholder="Ej: https://www.youtube.com/watch?v=XXXXXX" required> <small style="color: #94a3b8;">La URL se usar√° para incrustar el video en la vista del usuario.</small> </div> <div class="form-group"> <label for="course-category">Categor√≠a</label> <select id="course-category"> <option value="banco">BANCO (NATURA Y DUPREE)</option> <option value="auna">AUNA</option> <option value="desarrollo">Desarrollo Profesional</option> <option value="liderazgo">Liderazgo y Gesti√≥n</option> </select> </div> <button type="submit" class="btn-save btn-action"> <span class="material-icons-outlined" style="font-size: 18px;">save</span> Guardar Curso y Material </button> </form> </div>
            <div class="section-card" style="margin-top: 30px;"> <h2>Lista de Cursos Creados</h2> <table class="data-table"> <thead> <tr> <th>ID</th> <th>T√≠tulo</th> <th>Categor√≠a</th> <th>Material</th> <th>Estado</th> <th>Acciones</th> </tr> </thead> <tbody id="course-list-body"> 
                </tbody> </table> </div>
        </div>

        <div id="evaluations-view" class="view" style="display: none;">
            <div class="section-title-eval"> <span class="material-icons">assignment</span> Crear Evaluaci√≥n Gamificada </div>
            <form id="create-evaluation-form">
                <div class="form-group"> <label for="material-select">Material de Capacitaci√≥n</label> <select id="material-select"> <option value="">Selecciona un material</option> <option value="101">101 - Protocolos de Servicio al Cliente</option> <option value="102">102 - Inducci√≥n M√©dica Obligatoria</option> </select> </div>
                <div class="form-group"> <label for="mission-title">T√≠tulo de la Misi√≥n</label> <input type="text" id="mission-title" placeholder="Ej: Misi√≥n Ventas Especiales" required> </div>
                <div class="form-group"> <label for="mission-history">Historia de la Misi√≥n</label> <textarea id="mission-history" rows="4" placeholder="Describe la historia y objetivos de la misi√≥n..." required></textarea> </div>
                <h3 style="margin-top: 30px; margin-bottom: 10px; font-weight: 500;">Tipo de Evaluaci√≥n Kinest√©sica</h3>
                <div class="evaluation-grid">
                    <div class="evaluation-card" data-type="drag-drop"> <span class="material-icons-outlined">drag_indicator</span> <h4>Arrastrar y Soltar</h4> <p>Organiza conceptos arrastrando elementos</p> </div>
                    <div class="evaluation-card" data-type="timeline"> <span class="material-icons-outlined">timeline</span> <h4>Constructor de L√≠nea de Tiempo</h4> <p>Ordena eventos cronol√≥gicamente</p> </div>
                    <div class="evaluation-card" data-type="memory"> <span class="material-icons-outlined">view_carousel</span> <h4>Memoria de Cartas</h4> <p>Encuentra pares de conceptos relacionados</p> </div>
                    <div class="evaluation-card" data-type="scenario"> <span class="material-icons">crop_square</span> <h4>Escenario Interactivo</h4> <p>Toma decisiones en situaciones reales</p> </div>
                    <div class="evaluation-card" data-type="puzzle"> <span class="material-icons">extension</span> <h4>Constructor de Rompecabezas</h4> <p>Arma procesos paso a paso</p> </div>
                    <div class="evaluation-card" data-type="simulator"> <span class="material-icons">videogame_asset</span> <h4>Simulador de Habilidades</h4> <p>Practica habilidades en entorno virtual</p> </div>
                </div>
                <div id="evaluation-content-area" style="display: none;"></div>
                <div class="stats-grid" style="gap: 20px;">
                    <div class="form-group"> <label for="difficulty">Dificultad</label> <select id="difficulty"> <option value="easy">F√°cil</option> <option value="medium" selected>Intermedio</option> <option value="hard">Dif√≠cil</option> </select> </div>
                    <div class="form-group"> <label for="time-limit">Tiempo L√≠mite</label> <select id="time-limit"> <option value="10">10 minutos</option> <option value="20" selected>20 minutos</option> <option value="30">30 minutos</option> </select> </div>
                    <div class="form-group"> <label for="lives">Vidas</label> <select id="lives"> <option value="1">1 vida</option> <option value="3" selected>3 vidas</option> <option value="5">5 vidas</option> </select> </div>
                </div>
                <div class="form-actions"> <button type="button" class="btn-cancel">Cancelar</button> <button type="submit" class="btn-create-eval">Crear Evaluaci√≥n</button> </div>
            </form>
        </div>

        <div id="finance-view" class="view" style="display: none;">
            <div class="section-card">
                <h2 style="border-bottom: none; padding-bottom: 0;">üíµ Resumen Financiero</h2>
                <p style="color: #94a3b8; margin-bottom: 20px;">Reportes clave de ventas y pagos relacionados con la plataforma.</p>
                
                <section class="stats-grid">
                    <div class="stat-card ingresos">
                        <div class="stat-card-title">Ingresos Netos (√öltimos 30 d√≠as)</div>
                        <div class="stat-card-value">$ 8,500 USD</div>
                        <div style="font-size: 12px; color: #10b981;">+15% vs. mes anterior</div>
                    </div>
                    
                    <div class="stat-card pendientes">
                        <div class="stat-card-title">Facturas Pendientes de Pago</div>
                        <div class="stat-card-value">5</div>
                        <div style="font-size: 12px; color: #dc2626;">Total: $ 1,200 USD</div>
                    </div>
                </section>
                
                <h2 style="margin-top: 30px;">Historial de Transacciones</h2>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ID Transacci√≥n</th>
                            <th>Curso</th>
                            <th>Cliente</th>
                            <th>Monto</th>
                            <th>Fecha</th>
                            <th>Estado</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr> <td>#9012</td> <td>Liderazgo Avanzado</td> <td>BANCO DUPREE</td> <td>$ 5,000</td> <td>2025-10-25</td> <td><span style="color: #10b981;">Pagado</span></td> </tr>
                        <tr> <td>#9013</td> <td>Inducci√≥n AUNA</td> <td>AUNA</td> <td>$ 800</td> <td>2025-11-01</td> <td><span style="color: #f97316;">Pendiente</span></td> </tr>
                        <tr> <td>#9014</td> <td>Servicio al Cliente</td> <td>BANCO NATURA</td> <td>$ 1,500</td> <td>2025-11-10</td> <td><span style="color: #10b981;">Pagado</span></td> </tr>
                        <tr> <td>#9015</td> <td>Ventas y Sondeo</td> <td>Freelance S.A.</td> <td>$ 200</td> <td>2025-11-15</td> <td><span style="color: #dc2626;">Vencido</span></td> </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div id="settings-view" class="view" style="display: none;"><div class="section-card"><h2>‚öôÔ∏è Configuraci√≥n del Sistema</h2><p>Contenido para Configuraci√≥n...</p></div></div>

    </div>
  </main>
  
  <script>
    // Funci√≥n para manejar el cambio entre sub-vistas (Gesti√≥n de Usuarios)
    function showSubView(subViewId) {
        document.getElementById('list-users-subview').style.display = 'none';
        document.getElementById('create-user-subview').style.display = 'none';
        
        document.getElementById(subViewId).style.display = 'block';
    }

    document.addEventListener('DOMContentLoaded', () => {
        const navLinks = document.querySelectorAll('.nav-link');
        const viewTitle = document.getElementById('view-title');
        const createCourseForm = document.getElementById('create-course-form');
        const courseListBody = document.getElementById('course-list-body');
        const evaluationCards = document.querySelectorAll('.evaluation-card'); 
        const createEvaluationForm = document.getElementById('create-evaluation-form'); 
        const evaluationContentArea = document.getElementById('evaluation-content-area');
        const createAdminForm = document.getElementById('create-admin-form');
        const userTableBody = document.getElementById('user-table-body');
        const userCountDisplay = document.getElementById('user-count-display');

        
        // --- DATA MAPS ---
        
        // Datos para los Widgets del Dashboard (Datos "reales")
        const adminMetrics = {
            totalRegistered: '3,150',
            registeredChange: '+180 nuevos en 7 d√≠as',
            averageProgress: '72%',
            progressGoal: 'Meta: 85% de avance general',
            averageGrade: '9.2/10',
            gradeReinforcement: 'Usuarios que requieren refuerzo: 8%',
            completedCourses: '1,450',
            completionRate: 'Tasa de finalizaci√≥n: 65%'
        };
        
        // Cargar usuarios desde localStorage (incluye admin principal y registrados)
        const defaultUsers = [
            { id: 0, fullName: 'Administrador Principal', username: 'admin', dni: '00000000', status: 'Activo', role: 'Admin (Principal)', isAdmin: true, isDefault: true },
            { id: 1, fullName: 'Ana Mart√≠nez', username: 'amartinez', dni: '45678901', status: 'Activo', role: 'Usuario', isAdmin: false, isDefault: true }
        ];

        let registeredUsers = JSON.parse(localStorage.getItem('registeredUsers')) || [];
        let usersList = [...defaultUsers.filter(u => u.isDefault === true)];
        
        const defaultUsernames = usersList.map(u => u.username);
        
        registeredUsers.forEach((user, index) => {
            if (!defaultUsernames.includes(user.username)) {
                usersList.push({
                    ...user,
                    id: 1000 + index, 
                    isAdmin: user.role && user.role.includes('Admin')
                });
            }
        });
        
        // Cargar cursos desde localStorage o usar defaults
        let courses = JSON.parse(localStorage.getItem('allCourses')) || [
            { id: 101, title: 'Protocolos de Servicio al Cliente', category: 'BANCO (NATURA Y DUPREE)', material: 'videocam', status: 'Publicado', url: 'https://www.youtube.com/embed/dQw4w9WgXcQ', description: 'M√≥dulo esencial sobre la nueva normativa de atenci√≥n y fidelizaci√≥n de clientes.', progress: 75, evaluationId: 501 },
            { id: 102, title: 'Inducci√≥n M√©dica Obligatoria', category: 'AUNA', material: 'link', status: 'Borrador', url: 'https://player.vimeo.com/video/84102980', description: 'Revisi√≥n anual de pol√≠ticas de seguridad y nuevos procedimientos internos.', progress: 10, evaluationId: 502 }
        ];
        let courseCounter = courses.length > 0 ? courses[courses.length - 1].id + 1 : 103;

        const viewMap = {
            'dashboard': 'Dashboard Principal',
            'users': 'Gesti√≥n de Usuarios',
            'courses': 'Gesti√≥n de Cursos',
            'evaluations': 'Crear Evaluaciones',
            'finance': 'Finanzas',
            'settings': 'Configuraci√≥n del Sistema'
        };
        
        // Mapa de Contenido Din√°mico para cada tipo de Evaluaci√≥n (se mantiene)
        const evaluationContentMap = {
            'drag-drop': `
                <h3>Crear Pares Arrastrables</h3>
                <p style="color: #94a3b8; margin-bottom: 10px;">Define los elementos que el usuario debe arrastrar y soltar para hacer *match*.</p>
                <div class="form-group">
                    <label>Par 1: Elemento A / Elemento B</label>
                    <input type="text" placeholder="Concepto (Ej: Liderazgo)" style="width: 48%; display: inline-block; margin-right: 4px;">
                    <input type="text" placeholder="Definici√≥n o sin√≥nimo" style="width: 48%; display: inline-block;">
                </div>
                <div class="form-group">
                    <label>Par 2: Elemento A / Elemento B</label>
                    <input type="text" placeholder="Concepto (Ej: Innovaci√≥n)" style="width: 48%; display: inline-block; margin-right: 4px;">
                    <input type="text" placeholder="Definici√≥n o sin√≥nimo" style="width: 48%; display: inline-block;">
                </div>
                <button type="button" class="btn-action" style="background: #a855f7; margin-top: 10px;">A√±adir m√°s Pares</button>
            `,
            'timeline': `
                <h3>Definir Eventos Cronol√≥gicos</h3>
                <p style="color: #94a3b8; margin-bottom: 10px;">Introduce los eventos en el orden **correcto** (el usuario los ordenar√° despu√©s).</p>
                <div class="form-group"><label>Evento 1 (m√°s antiguo)</label><input type="text" placeholder="Ej: Fusi√≥n de la empresa A y B (2010)" required></div>
                <div class="form-group"><label>Evento 2</label><input type="text" placeholder="Ej: Lanzamiento del producto X (2015)" required></div>
                <div class="form-group"><label>Evento 3 (m√°s reciente)</label><input type="text" placeholder="Ej: Expansi√≥n al mercado Y (2020)" required></div>
                <button type="button" class="btn-action" style="background: #a855f7; margin-top: 10px;">A√±adir m√°s Eventos</button>
            `,
            'memory': `
                <h3>Crear Pares de Memoria (Cartas)</h3>
                <p style="color: #94a3b8; margin-bottom: 10px;">Crea las parejas que el usuario debe memorizar y voltear. Deben ser visuales o conceptuales.</p>
                <div class="form-group">
                    <label>Par 1: Carta A / Carta B</label>
                    <input type="text" placeholder="Elemento A (Ej: Producto)" style="width: 48%; display: inline-block; margin-right: 4px;">
                    <input type="text" placeholder="Elemento B (Ej: Beneficio)" style="width: 48%; display: inline-block;">
                </div>
                <div class="form-group">
                    <label>Par 2: Carta A / Carta B</label>
                    <input type="text" placeholder="Elemento A (Ej: Misi√≥n)" style="width: 48%; display: inline-block; margin-right: 4px;">
                    <input type="text" placeholder="Elemento B (Ej: Visi√≥n)" style="width: 48%; display: inline-block;">
                </div>
                <button type="button" class="btn-action" style="background: #a855f7; margin-top: 10px;">A√±adir m√°s Pares</button>
            `,
            'scenario': `
                <h3>Dise√±o de Escenario Interactivo</h3>
                <p style="color: #94a3b8; margin-bottom: 15px;">Define los puntos de decisi√≥n clave, las consecuencias y el camino √≥ptimo a seguir en la simulaci√≥n.</p>
                <div class="form-group">
                    <label>Escenario Inicial</label>
                    <textarea rows="3" placeholder="Descripci√≥n de la situaci√≥n que enfrenta el usuario..."></textarea>
                </div>
                <div class="form-group">
                    <label>Opci√≥n A / Consecuencia (Ruta Correcta)</label>
                    <input type="text" placeholder="Opci√≥n de Decisi√≥n A" style="width: 48%; display: inline-block; margin-right: 4px;">
                    <input type="text" placeholder="Consecuencia/Feedback" style="width: 48%; display: inline-block;">
                </div>
                <button type="button" class="btn-action" style="background: #a855f7; margin-top: 10px;">A√±adir Decisi√≥n/Ruta</button>
            `,
            'puzzle': `
                <h3>Definici√≥n de Piezas del Rompecabezas</h3>
                <p style="color: #94a3b8; margin-bottom: 15px;">Define la secuencia o las im√°genes que el usuario debe armar para completar el proceso o concepto.</p>
                <div class="form-group">
                    <label>Pieza 1 (Inicio de la Secuencia)</label>
                    <input type="text" placeholder="Ej: Paso 1: Recibir solicitud del cliente" required>
                </div>
                <div class="form-group">
                    <label>Pieza 2</label>
                    <input type="text" placeholder="Ej: Paso 2: Verificar inventario" required>
                </div>
                <button type="button" class="btn-action" style="background: #a855f7; margin-top: 10px;">A√±adir m√°s Piezas</button>
            `,
            'simulator': `
                <h3>Configuraci√≥n del Entorno de Simulaci√≥n</h3>
                <p style="color: #94a3b8; margin-bottom: 10px;">Define las variables iniciales, el objetivo de la simulaci√≥n y los par√°metros de √©xito o fracaso.</p>
                <div class="form-group">
                    <label>Objetivo de la Simulaci√≥n</label>
                    <input type="text" placeholder="Ej: Aumentar la tasa de retenci√≥n al 90% en 5 rondas." required>
                </div>
                <div class="form-group">
                    <label>Variable a Monitorear</label>
                    <input type="text" placeholder="Ej: Nivel de Satisfacci√≥n del Cliente (0-100)" required>
                </div>
                <button type="button" class="btn-action" style="background: #a855f7; margin-top: 10px;">A√±adir Variables</button>
            `,
        };

        // --- FUNCIONES DE RENDERIZADO ---
        
        function renderDashboardWidgets() {
            document.getElementById('total-registered').textContent = usersList.length;
            document.getElementById('registered-change').textContent = adminMetrics.registeredChange;
            
            document.getElementById('average-progress').textContent = adminMetrics.averageProgress;
            document.getElementById('progress-goal').textContent = adminMetrics.progressGoal;

            document.getElementById('average-grade').textContent = adminMetrics.averageGrade;
            document.getElementById('grade-reinforcement').textContent = adminMetrics.gradeReinforcement;

            document.getElementById('completed-courses').textContent = adminMetrics.completedCourses;
            document.getElementById('completion-rate').textContent = adminMetrics.completionRate;
        }
        
        function renderUserTable() {
            userTableBody.innerHTML = '';
            userCountDisplay.textContent = usersList.length;

            usersList.forEach(user => {
                const statusColor = user.status === 'Activo' ? '#10b981' : '#f97316';
                let roleText = user.role;
                
                if (user.username === 'admin') {
                    roleText = 'Admin (Principal)';
                }

                const newRow = `
                    <tr>
                        <td>${user.id}</td>
                        <td>${user.fullName}</td>
                        <td>${user.username}</td>
                        <td>${user.dni || 'N/A'}</td>
                        <td><span style="color: ${statusColor};">${user.status}</span></td>
                        <td>${roleText}</td>
                        <td>
                            <span class="material-icons-outlined" style="font-size: 18px; color: #6366f1; cursor: pointer;">edit</span> 
                            <span class="material-icons-outlined" style="font-size: 18px; color: #dc2626; margin-left: 10px; cursor: pointer;">delete</span>
                        </td>
                    </tr>
                `;
                userTableBody.insertAdjacentHTML('beforeend', newRow);
            });
        }

        function changeView(viewId) {
            document.querySelectorAll('.view').forEach(view => { view.style.display = 'none'; });
            document.querySelectorAll('.nav-link').forEach(link => { link.classList.remove('active'); });

            const selectedView = document.getElementById(`${viewId}-view`);
            if (selectedView) {
                selectedView.style.display = 'block';
                viewTitle.textContent = viewMap[viewId];

                const activeLink = document.querySelector(`.nav-link[data-view="${viewId}"]`);
                if (activeLink) { activeLink.classList.add('active'); }
                
                if (viewId === 'dashboard') {
                    renderDashboardWidgets();
                } else if (viewId === 'users') {
                    renderUserTable();
                    showSubView('list-users-subview');
                } else if (viewId === 'courses') {
                    renderCourseList();
                }
            }
        }
        
        function renderCourseList() {
            courseListBody.innerHTML = '';
            
            courses = JSON.parse(localStorage.getItem('allCourses')) || courses;
            
            courses.forEach(course => {
                const statusColor = course.status === 'Publicado' ? '#10b981' : '#f97316';
                const materialIcon = `<span class="material-icons-outlined" style="color: ${course.material === 'videocam' ? '#6366f1' : '#10b981'}; font-size: 18px;">${course.material}</span>`;

                const newRow = `
                    <tr>
                        <td>${course.id}</td>
                        <td>${course.title}</td>
                        <td>${course.category}</td>
                        <td>${materialIcon}</td>
                        <td><span style="color: ${statusColor};">${course.status}</span></td>
                        <td><span class="material-icons-outlined" style="font-size: 18px; color: #6366f1; cursor: pointer;">edit</span> <span class="material-icons-outlined" style="font-size: 18px; color: #dc2626; margin-left: 10px; cursor: pointer;">delete</span></td>
                    </tr>
                `;
                courseListBody.insertAdjacentHTML('beforeend', newRow);
            });
        }
        
        // --- L√ìGICA DE EVENTOS ---

        // 1. L√ìGICA DE CREACI√ìN DE USUARIO ADMINISTRATIVO
        createAdminForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('admin-name').value;
            const username = document.getElementById('admin-username').value;
            const password = document.getElementById('admin-password').value;
            
            if (usersList.some(u => u.username === username)) {
                alert('üõë Error: El nombre de usuario ya est√° en uso. Intenta con otro.');
                return;
            }

            const permissions = Array.from(document.querySelectorAll('.permission-box input[type="checkbox"]:checked'))
                                     .map(cb => cb.id);

            const roleName = permissions.length > 3 ? 'Admin (Parcial)' : 'Admin (Reporte)';
            
            const newAdminUser = {
                id: usersList.length + 100, 
                fullName: name,
                username: username,
                dni: 'N/A',
                password: password,
                status: 'Activo',
                role: roleName,
                isAdmin: true
            };
            
            usersList.push(newAdminUser);
            // Simular la actualizaci√≥n de la lista total de usuarios (incluye el nuevo admin)
            // Nota: Aqu√≠ se est√° actualizando la lista de usuarios regulares en localStorage
            localStorage.setItem('registeredUsers', JSON.stringify(usersList.filter(u => u.role === 'Usuario' || u.role === 'user')));

            alert(`‚úÖ Cuenta Administrativa Creada: \nNombre: ${name}\nUsuario: ${username}\nRol: ${roleName}`);
            
            createAdminForm.reset();
            renderUserTable();
            showSubView('list-users-subview');
        });

        // 2. MANEJO DE SELECCI√ìN DE TARJETAS DE EVALUACI√ìN
        evaluationCards.forEach(card => {
            card.addEventListener('click', function() {
                evaluationCards.forEach(c => c.classList.remove('selected'));
                this.classList.add('selected');
                
                const selectedType = this.getAttribute('data-type');
                evaluationContentArea.innerHTML = evaluationContentMap[selectedType];
                evaluationContentArea.style.display = 'block';
            });
        });
        
        // 3. L√ìGICA DE CREACI√ìN DE EVALUACIONES
        createEvaluationForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const selectedMaterial = document.getElementById('material-select').options[document.getElementById('material-select').selectedIndex].text;
            const missionTitle = document.getElementById('mission-title').value;
            const selectedTypeCard = document.querySelector('.evaluation-card.selected');
            
            if (!selectedTypeCard) {
                alert('üõë Debes seleccionar un Tipo de Evaluaci√≥n Kinest√©sica para continuar.');
                return;
            }

            const selectedType = selectedTypeCard.getAttribute('data-type');
            
            alert(`‚úÖ Evaluaci√≥n "${missionTitle}" guardada. Tipo: ${selectedType}. Contenido listo para el examen de usuario.`);
            
            createEvaluationForm.reset();
            evaluationContentArea.style.display = 'none';
            if (document.querySelector('.evaluation-card.selected')) {
                document.querySelector('.evaluation-card.selected').classList.remove('selected');
            }
            changeView('evaluations'); 
        });


        // 4. L√ìGICA DE CREACI√ìN DE CURSOS (ACTUALIZADA PARA USAR SUPABASE)
        createCourseForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const title = document.getElementById('course-title').value;
            const description = document.getElementById('course-description').value;
            const videoUrl = document.getElementById('video-url').value; 
            const categorySelect = document.getElementById('course-category');
            const categoryText = categorySelect.options[categorySelect.selectedIndex].text;
            
            // 1. Validar que el video es una URL (opcional pero recomendado)
            if (!videoUrl.startsWith('http')) {
                alert('La URL del video no parece ser v√°lida. Debe empezar con http o https.');
                return;
            }
            
            // 2. Enviar datos a Supabase
            const { data, error } = await supabase
                .from('cursos') // Nombre de la tabla creada
                .insert([
                    { 
                        titulo: title,
                        descripcion: description,
                        url_video: videoUrl,
                        categoria: categoryText,
                        estado: 'Publicado' 
                    }
                ])
                .select(); 
                
            if (error) {
                console.error("Error al guardar curso en Supabase:", error);
                alert(`üõë Error al guardar: ${error.message}. Aseg√∫rate de haber iniciado sesi√≥n como Admin.`);
                return;
            }

            // 3. Simular actualizaci√≥n local (para mantener la vista sin recargar)
            const newCourse = data[0]; 
            courses.push({
                id: newCourse.id, // Usamos el ID de Supabase
                title: newCourse.titulo,
                category: newCourse.categoria,
                material: newCourse.url_video.includes('youtube') || newCourse.url_video.includes('vimeo') ? 'videocam' : 'link',
                status: newCourse.estado, 
                url: newCourse.url_video,
                description: newCourse.descripcion, 
                progress: 0, 
                evaluationId: 999,
            });

            // 4. Guardamos la lista actualizada de cursos en localStorage para que el Portal pueda leerla
            localStorage.setItem('allCourses', JSON.stringify(courses));
            renderCourseList();

            alert(`‚úÖ Curso "${title}" guardado y disponible en la base de datos.`);
            createCourseForm.reset();
        });


        // 5. MANEJO DE NAVEGACI√ìN Y CIERRE DE SESI√ìN
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const viewId = link.getAttribute('data-view');
                changeView(viewId);
            });
        });
        
        document.querySelector('.logout-btn').addEventListener('click', function() {
            alert('Cerrando sesi√≥n del Administrador...');
            window.location.href = 'index.html';
        });
        
        // Inicializaci√≥n
        changeView('dashboard');
    });
  </script>
</body>
</html>